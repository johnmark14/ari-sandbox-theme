{%- doc -%}
  Renders a selectable upgrade variant card for the bike builder.

  @param {object} upgrade_variant - The variant object to render
  @param {object} upgrade_product - The parent product object
  @param {string} category_handle - The upgrade category handle (e.g., "bike_wheelset")
  @param {number} category_index - The step index for this category
  @param {number} base_price - The base bike variant price (subtracted to show upgrade cost)
{%- enddoc -%}

{% liquid
  assign upgrade_cost = upgrade_variant.price | minus: base_price
  assign price = upgrade_cost | money

  if upgrade_product.has_only_default_variant
    assign card_title = upgrade_product.title
  else
    assign card_title = upgrade_variant.title
  endif

  if upgrade_variant.image
    assign card_image = upgrade_variant.image
  elsif upgrade_product.featured_image
    assign card_image = upgrade_product.featured_image
  else
    assign card_image = null
  endif
%}

<label class="bike-builder__upgrade-card">
  <input
    type="radio"
    name="upgrade-{{ category_handle }}"
    value="{{ upgrade_variant.id }}"
    data-upgrade-title="{{ card_title | escape }}"
    data-upgrade-price="{{ upgrade_variant.price }}"
    data-upgrade-handle="{{ category_handle }}"
    class="visually-hidden"
    on:change="/handleUpgradeSelect"
  >
  <div class="bike-builder__upgrade-card-inner">
    {% if card_image %}
      <div class="bike-builder__upgrade-card-media">
        {{
          card_image
          | image_url: width: 400
          | image_tag:
            loading: 'lazy',
            widths: '200, 400',
            sizes: '(min-width: 750px) 200px, 50vw',
            class: 'bike-builder__upgrade-card-image'
        }}
      </div>
    {% else %}
      <div class="bike-builder__upgrade-card-media bike-builder__upgrade-card-media--placeholder">
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
      </div>
    {% endif %}
    <div class="bike-builder__upgrade-card-info">
      <span class="bike-builder__upgrade-card-title">{{ card_title }}</span>
      <span class="bike-builder__upgrade-card-price">+ {{ price }}</span>
    </div>
    <div class="bike-builder__upgrade-card-check" aria-hidden="true">
      <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
        <path class="bike-builder__upgrade-card-check-mark" d="M6 10l3 3 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
  </div>
</label>
